

function Notificar(ch_norma) {
    var sucesso = function (data) {
        if (IsNotNullOrEmpty(data, 'error_message')) {
            $('#div_notificacao_norma').messagelight({
                sTitle: "Erro",
                sContent: data.error_message,
                sType: "error",
                sWidth: "",
                iTime: null
            });
        }
        else if (IsNotNullOrEmpty(data, 'email_usuario_push')) {
            $("<div id='modal_notifiqueme' />").modallight({
                sTitle: "Notifique-me",
                sType: "success",
                sContent: "Norma monitorada com sucesso.",
                oButtons: [
                    {
                        text: "Ok",
                        click: function () {
                            $(this).dialog('close');
                        }
                    }
                ],
                fnClose: function () {
                    document.location.reload();
                }
            });
        }
        else {
            $('#div_notificacao_norma').messagelight({
                sTitle: "Erro",
                sContent: "Ocorreu um erro não identificado.",
                sType: "error",
                sWidth: "",
                iTime: null
            });
        }
    }
    var inicio = function () {
        $('#div_loading_norma').show();
        $('#div_norma').hide();
    }
    var complete = function () {
        gComplete();
        if (!IsNotNullOrEmpty(_notifiqueme)) {
            $("<div id='modal_notifiqueme' />").modallight({
                sTitle: "Notifique-me",
                sType: "alert",
                sContent: "Para seguir esta norma, é necessário fazer login no Notifique-me.",
                oButtons: [
                        {
                            text: "Ok",
                            click: function () {
                                var pagina_atual = document.URL;
                                var pagina_atual_array = pagina_atual.split("/");
                                pagina_atual = pagina_atual_array[pagina_atual_array.length - 1];
                                pagina_atual = pagina_atual.replace(/\?/g, "__QUERY__");
                                pagina_atual = pagina_atual.replace(/\&/g, "__AND__");
                                pagina_atual = pagina_atual.replace(/\=/g, "__EQUAL__");
                                document.location.href = "./LoginNotifiqueme.aspx?redirecionar_notifiqueme=" + pagina_atual + "__AND__ch_norma__EQUAL__" + ch_norma;
                            }
                        }
                    ]
            });
        }
    }
    $.ajaxlight({
        sUrl: "./ashx/Push/NotifiquemeNormaIncluir.ashx?ch_norma=" + ch_norma,
        sType: "GET",
        fnSuccess: sucesso,
        fnComplete: complete,
        fnBeforeSend: gInicio,
        bAsync: true,
        iTimeout: 40000
    });
}

function PararNotificar(ch_norma) {
    var sucesso = function (data) {
        if (IsNotNullOrEmpty(data, 'error_message')) {
            $('#div_notificacao_norma').messagelight({
                sTitle: "Erro",
                sContent: data.error_message,
                sType: "error",
                sWidth: "",
                iTime: null
            });
        }
        else if (IsNotNullOrEmpty(data, 'email_usuario_push')) {
            $("<div id='modal_notifiqueme' />").modallight({
                sTitle: "Notifique-me",
                sType: "success",
                sContent: "A Norma não será mais monitorada.",
                oButtons: [
                    {
                        text: "Ok",
                        click: function () {
                            $(this).dialog('close');
                        }
                    }
                ],
                fnClose: function () {
                    document.location.reload();
                }
            });
        }
        else {
            $('#div_notificacao_norma').messagelight({
                sTitle: "Erro",
                sContent: "Ocorreu um erro não identificado.",
                sType: "error",
                sWidth: "",
                iTime: null
            });
        }
    }
    $.ajaxlight({
        sUrl: "./ashx/Push/NotifiquemeNormaExcluir.ashx?ch_norma=" + ch_norma,
        sType: "GET",
        fnSuccess: sucesso,
        fnComplete: gComplete,
        fnBeforeSend: gInicio,
        bAsync: true,
        iTimeout: 40000
    });
}

function fnAutocompleteOrigem() {
    $('#div_autocomplete_origem_modal').autocompletelight({
        sKeyDataName: "ch_orgao",
        sValueDataName: "get_sg_hierarquia_nm_vigencia",
        sInputHiddenName: "ch_orgao",
        sInputName: "sg_hierarquia_nm_vigencia",
        sAjaxUrl: './ashx/Autocomplete/OrgaoAutocomplete.ashx?' + (ValidarOrigem() ? "id_orgao_cadastrador=" + _user.orgao_cadastrador.id_orgao_cadastrador : "") + ($("#checkbox_retroativo").prop("checked") ? '' : '&st_orgao=true'),
//        sAjaxUrl: './ashx/Autocomplete/OrgaoAutocomplete.ashx?' + (isSuperAdmin() ? "" : "id_orgao_cadastrador=" + _user.orgao_cadastrador.id_orgao_cadastrador) + ($("#checkbox_retroativo").prop("checked") ? '' : '&st_orgao=true'),
        bLinkAll: true,
        sLinkName: "a_origem",
        dOthersHidden: [
                        { campo_app: "label_nm_orgao_modal", campo_base: "nm_orgao" },
                        { campo_app: "label_sg_orgao_modal", campo_base: "sg_orgao" },
                        { campo_app: "label_sg_hierarquia_modal", campo_base: "sg_hierarquia" },
                        { campo_app: "label_nm_hierarquia_modal", campo_base: "nm_hierarquia" },
                        { campo_app: "label_in_ambito_modal", campo_base: "ambito.nm_ambito" },
                        { campo_app: "label_dt_inicio_vigencia_modal", campo_base: "dt_inicio_vigencia" },
                        { campo_app: "label_dt_fim_vigencia_modal", campo_base: "dt_fim_vigencia" },
                        { campo_app: "label_orgao_cadastrador_modal", campo_base: "get_orgaos_cadastradores" }
                    ]
    });
}

function fnAutocompleteSituacao(aSituacoes) {
    $('#div_autocomplete_situacao').autocompletelight({
        sKeyDataName: "ch_situacao",
        sValueDataName: "nm_situacao",
        sInputHiddenName: "ch_situacao",
        sInputName: "nm_situacao",
        jData: aSituacoes,
        bLinkAll: true,
        sLinkName: "a_situacao"
    });
}

function ValidarOrigem() {
    // Se o usuário for SuperAdmin, pode cadastrar qualquer origem
    // Se for um ato conjunto, a validação só deve ser feita para o primeiro órgão
    if (!isSuperAdmin() && ($('#tbody_origens input[name="orgao"]').length <= 0)) {
        return true;
    }
} 

function fnAutocompleteVocabulario(element) {
    var inicio_sem_coringa = "0";
    if ($(element).is(':checked')) {
        inicio_sem_coringa = "1"
    }
    $('#div_autocomplete_termo_modal').autocompletelight({
        sKeyDataName: "ch_termo",
        sValueDataName: "nm_termo",
        sInputHiddenName: "ch_termo_modal",
        sInputName: "nm_termo_modal",
        sAjaxUrl: "./ashx/Autocomplete/VocabularioAutocomplete.ashx?cad=true&inicio_sem_coringa="+inicio_sem_coringa,
        bLinkAll: true,
        sLinkName: "a_termo",
        jPagination: { bPaginate: true,
                    iDisplayLength: 10,
                    bButtonsPaginate: true
                },
        dOthersHidden: [
                        { campo_app: "ch_tipo_termo_modal", campo_base: "ch_tipo_termo" }
                    ]
    });
}

function ConstruirControlesDinamicos() {
    SelecionarTipoDeNorma();
    $('#div_autocomplete_tipo_norma').autocompletelight({
        sKeyDataName: "ch_tipo_norma",
        sValueDataName: "nm_tipo_norma",
        sInputHiddenName: "ch_tipo_norma",
        sInputName: "nm_tipo_norma",
        sAjaxUrl: "./ashx/Autocomplete/TipoDeNormaAutocomplete.ashx" + (isSuperAdmin() ? "" : "?id_orgao_cadastrador=" + _user.orgao_cadastrador.id_orgao_cadastrador),
        bLinkAll: true,
        sLinkName: "a_tipo_norma",
        dOthersHidden: [
                            { campo_app: "in_g1", campo_base: "in_g1" },
                            { campo_app: "in_g2", campo_base: "in_g2" },
                            { campo_app: "in_g3", campo_base: "in_g3" },
                            { campo_app: "in_g4", campo_base: "in_g4" },
                            { campo_app: "in_g5", campo_base: "in_g5" },
                            { campo_app: "EhLei", campo_base: "EhLei" },
                            { campo_app: "EhDecreto", campo_base: "EhDecreto" },
                            { campo_app: "EhResolucao", campo_base: "EhResolucao" },
                            { campo_app: "EhPortaria", campo_base: "EhPortaria" },
                            { campo_app: "in_conjunta", campo_base: "in_conjunta" },
                            { campo_app: "in_numeracao_por_orgao", campo_base: "in_numeracao_por_orgao" },
                            { campo_app: "in_apelidavel", campo_base: "in_apelidavel" }
                        ]
        });
    fnAutocompleteOrigem();
    fnAutocompleteVocabulario();
    $('#div_autocomplete_autoria_modal').autocompletelight({
        sKeyDataName: "ch_autoria",
        sValueDataName: "nm_autoria",
        sInputHiddenName: "ch_autoria",
        sInputName: "nm_autoria",
        sAjaxUrl: "./ashx/Autocomplete/AutoriaAutocomplete.ashx",
        bLinkAll: true,
        sLinkName: "a_autoria"
    });
    $('#div_autocomplete_interessado_modal').autocompletelight({
        sKeyDataName: "ch_interessado",
        sValueDataName: "nm_interessado",
        sInputHiddenName: "ch_interessado",
        sInputName: "nm_interessado",
        sAjaxUrl: "./ashx/Autocomplete/InteressadoAutocomplete.ashx",
        bLinkAll: true,
        sLinkName: "a_interessado"
    });
    $('#div_autocomplete_tipo_fonte_modal').autocompletelight({
        sKeyDataName: "ch_tipo_fonte",
        sValueDataName: "nm_tipo_fonte",
        sInputHiddenName: "ch_tipo_fonte_modal",
        sInputName: "nm_tipo_fonte_modal",
        sAjaxUrl: "./ashx/Autocomplete/TipoDeFonteAutocomplete.ashx",
        bLinkAll: true,
        sLinkName: "a_tipo_fonte"
    });
    $('#div_autocomplete_tipo_edicao_modal').autocompletelight({
        sKeyDataName: "ch_tipo_edicao",
        sValueDataName: "nm_tipo_edicao",
        sInputHiddenName: "ch_tipo_edicao_modal",
        sInputName: "nm_tipo_edicao_modal",
        sAjaxUrl: "./ashx/Autocomplete/TipoDeEdicaoAutocomplete.ashx",
        bLinkAll: true,
        sLinkName: "a_tipo_edicao"
    });
    $('#div_autocomplete_tipo_publicacao_modal').autocompletelight({
        sKeyDataName: "ch_tipo_publicacao",
        sValueDataName: "nm_tipo_publicacao",
        sInputHiddenName: "ch_tipo_publicacao_modal",
        sInputName: "nm_tipo_publicacao_modal",
        sAjaxUrl: "./ashx/Autocomplete/TipoDePublicacaoAutocomplete.ashx",
        bLinkAll: true,
        sLinkName: "a_tipo_publicacao"
    });
    $('#div_autocomplete_requerente_modal').autocompletelight({
        sKeyDataName: "ch_requerente",
        sValueDataName: "nm_requerente",
        sInputHiddenName: "ch_requerente_modal",
        sInputName: "nm_requerente_modal",
        sAjaxUrl: "./ashx/Autocomplete/RequerenteAutocomplete.ashx",
        bLinkAll: true,
        sLinkName: "a_requerente"
    });
    $('#div_autocomplete_requerido_modal').autocompletelight({
        sKeyDataName: "ch_requerido",
        sValueDataName: "nm_requerido",
        sInputHiddenName: "ch_requerido_modal",
        sInputName: "nm_requerido_modal",
        sAjaxUrl: "./ashx/Autocomplete/RequeridoAutocomplete.ashx",
        bLinkAll: true,
        sLinkName: "a_requerido"
    });
    $('#div_autocomplete_procurador_modal').autocompletelight({
        sKeyDataName: "ch_procurador",
        sValueDataName: "nm_procurador",
        sInputHiddenName: "ch_procurador_modal",
        sInputName: "nm_procurador_modal",
        sAjaxUrl: "./ashx/Autocomplete/ProcuradorAutocomplete.ashx",
        bLinkAll: true,
        sLinkName: "a_procurador"
    });
    $('#div_autocomplete_relator_modal').autocompletelight({
        sKeyDataName: "ch_relator",
        sValueDataName: "nm_relator",
        sInputHiddenName: "ch_relator_modal",
        sInputName: "nm_relator_modal",
        sAjaxUrl: "./ashx/Autocomplete/RelatorAutocomplete.ashx",
        bLinkAll: true,
        sLinkName: "a_relator"
    });
    ConstruirAmbitos();
    $("#tbody_termos_modal").sortable({
        containment: "parent",
		forceHelperSize: true
    });
    $("#tbody_indexacoes").sortable({
        containment: "parent"
    });
    MarcarPendente();
}

function EditarFonte(event) {
    var tr_fonte = $(event.target).closest('tr');
    var sFonte = $($('input[name="fonte"]', $(tr_fonte))[0]).val();
    var oFonte = JSON.parse(sFonte);

    var oJsonDiario = {
        ch_tipo_fonte: oFonte.ch_tipo_fonte,
        nm_tipo_fonte: oFonte.nm_tipo_fonte,
        dt_assinatura: oFonte.dt_publicacao
    };

    $('#json_diario_fonte').val(JSON.stringify(oJsonDiario));
    $('#json_arquivo_diario_fonte').val(JSON.stringify(oFonte.ar_diario));
    $('#ds_diario').val(oFonte.ds_diario);
        
    $('#ch_tipo_publicacao_modal').val(oFonte.ch_tipo_publicacao);
    $('#nm_tipo_publicacao_modal').val(oFonte.nm_tipo_publicacao);

    $('#nr_pagina_modal').val(GetText(oFonte.nr_pagina));
    $('#nr_coluna_modal').val(GetText(oFonte.nr_coluna));
    $('#ds_observacao_fonte_modal').val(GetText(oFonte.ds_observacao_fonte));
    $('#ds_republicacao_modal').val(GetText(oFonte.ds_republicacao));
    CriarModalFonte(tr_fonte);
}

function CriarModalFonte(tr_fonte) {
    if (!IsNotNullOrEmpty(tr_fonte)) {
        $('#modal_fonte .diario').hide();
    }
    else {
        $('#modal_fonte .diario').show();
    }
    $('#modal_fonte .consultar').show();
    $('#modal_fonte .resultado').hide();

    $("#modal_fonte").modallight({
        sTitle: "Adicionar Fonte",
        sWidth: '620',
        oButtons: [
            {
                text: "Salvar",
                click: function () {
                    var oFonte = {};
                    oFonte.ch_tipo_publicacao = $('#ch_tipo_publicacao_modal').val();
                    oFonte.nm_tipo_publicacao = $('#nm_tipo_publicacao_modal').val();
                    oFonte.nr_pagina = $('#nr_pagina_modal').val();
                    oFonte.nr_coluna = $('#nr_coluna_modal').val();
                    oFonte.ds_observacao_fonte = $('#ds_observacao_fonte_modal').val();
                    oFonte.ds_republicacao = $('#ds_republicacao_modal').val();


                    var sJson_diario = $('#json_diario_fonte').val();

                    if(IsNotNullOrEmpty(sJson_diario)){
                        var oJson_diario = JSON.parse(sJson_diario);

                        oFonte.ch_tipo_fonte = oJson_diario.ch_tipo_fonte;
                        oFonte.nm_tipo_fonte = oJson_diario.nm_tipo_fonte;
                        oFonte.dt_publicacao = oJson_diario.dt_assinatura;
                        oFonte.ds_diario = $('#ds_diario').val();
                        var sJson_arquivo_diario = $('#json_arquivo_diario_fonte').val();
                        if(IsNotNullOrEmpty(sJson_arquivo_diario)){
                            oFonte.ar_diario = JSON.parse(sJson_arquivo_diario);
                        }
                    }

                    //Fonte não pode data de publicação anterior à data de assinatura da norma
                    if (IsNotNullOrEmpty(oFonte, 'dt_publicacao')) {
                        var date_publicacao = convertStringToDateTime(oFonte.dt_publicacao);
                        var date_assinatura = convertStringToDateTime($('#dt_assinatura').val());
                        if (date_publicacao < date_assinatura) {
                            $('#modal_fonte .notify').messagelight({
                                sTitle: "Erro",
                                sContent: "Fonte não pode possuir data de publicação anterior à data de assinatura da norma.",
                                sType: "error",
                                sWidth: "",
                                iTime: null
                            });
                            return false;
                        }
                    }

                    if (((IsNotNullOrEmpty(oFonte, 'ds_diario') && IsNotNullOrEmpty(oFonte, 'ar_diario')) || $('#ch_tipo_norma').val() == '11000000' ) && IsNotNullOrEmpty(oFonte, 'ch_tipo_fonte') && IsNotNullOrEmpty(oFonte, 'ch_tipo_publicacao')) {
                        $('#tbody_fontes .tr_vazia').remove();
                        var guid = Guid('N');
                        if (IsNotNullOrEmpty(tr_fonte)) {
                            $($(tr_fonte).find('td')[0]).text(oFonte.ds_diario);
                            $($(tr_fonte).find('td')[1]).text(oFonte.nm_tipo_publicacao);
                            $($(tr_fonte).find('td')[2]).text(oFonte.nr_pagina);
                            $($(tr_fonte).find('td')[3]).text(oFonte.nr_coluna);
                            $($(tr_fonte).find('td')[4]).text(oFonte.ds_observacao_fonte);
                            $($(tr_fonte).find('td')[5]).text(oFonte.ds_republicacao);
                            var json_arquivo = $('input.json_arquivo', $(tr_fonte).find('td')[6]).val();
                            if (IsNotNullOrEmpty(json_arquivo)) {
                                oFonte.ar_fonte = JSON.parse(json_arquivo);
                            }
                            $('input[name=fonte]', $(tr_fonte).find('td')[6]).val(JSON.stringify(oFonte));
                            $('a[ds_diario]', $(tr_fonte).find('td')[6]).attr('ds_diario', oFonte.ds_diario);
                        }
                        else {
                            var id_input = 'input_' + guid;
                            var id_td = 'td_' + guid;
                            var html_fonte = '<td>' + oFonte.ds_diario + '</td>' +
                                '<td>' + oFonte.nm_tipo_publicacao + '</td>' +
                                '<td>' + oFonte.nr_pagina + '</td>' +
                                '<td>' + oFonte.nr_coluna + '</td>' +
                                '<td>' + oFonte.ds_observacao_fonte + '</td>' +
                                '<td>' + oFonte.ds_republicacao + '</td>' +
                                '<td id="' + id_td + '">' +
                                    '<input id="' + id_input + '" type="hidden" name="fonte" value="" />' +
                                    '<input type="hidden" class="json_arquivo" value="" />' +
                                    '<label class="name" style="color:#000;"></label>' +
                                    '<a href="javascript:void(0);" onclick="javascript:anexarInputFile(this);" class="attach" title="Anexar um arquivo" ><img valign="absmiddle" alt="Anexar" src="' + _urlPadrao + '/Imagens/ico_attach_file2.png" width="18px" /></a>' +
                                    '<a href="javascript:void(0);" onclick="javascript:deletarInputFile(this);" class="delete" title="Remover o arquivo" style="display:none;"><img valign="absmiddle" alt="Remover" src="' + _urlPadrao + '/Imagens/ico_delete_file.png" width="18px" /></a>' +
                                    '<a path="ar_fonte" href="javascript:void(0);" onclick="javascript:editarInputFile(this);" class="create" title="Editar ou criar um arquivo"><img valign="absmiddle" alt="Editar" src="' + _urlPadrao + '/Imagens/ico_edit_file.png" width="18px" /></a>' +
                                    '<a path="ar_fonte" publicacao="' + oFonte.nm_tipo_publicacao + '" ds_diario="' + oFonte.ds_diario + '" div_arquivo="' + id_td + '" href="javascript:void(0);" onclick="javascript:abrirModalImportarArquivo(this);" class="import" title="Importar arquivo do módulo de arquivos"><img width="18px" valign="absmiddle" alt="Editar" src="' + _urlPadrao + '/Imagens/ico_import_file.png" /></a>' +
                                '</td>' +
                                '<td>' +
                                    '<a title="Editar Fonte" href="javascript:void(0);" onclick="javascript:EditarFonte(event);"><img valign="absmiddle" alt="Editar" src="' + _urlPadrao + '/Imagens/ico_pencil_p.png"  /></a>' +
                                    '<a title="Excluir Fonte" href="javascript:void(0);" onclick="javascript:DeletarLinha(event);"><img valign="absmiddle" alt="Excluir" src="' + _urlPadrao + '/Imagens/ico_delete_p.png"  /></a>' +
                                '</td>';
                            $('#tbody_fontes').append('<tr>' + html_fonte + '</tr>');
                            $('#' + id_input).val(JSON.stringify(oFonte));
                        }
                        $(this).dialog('close');
                    }
                    else {
                        $('#modal_fonte .notify').messagelight({
                            sTitle: "Erro",
                            sContent: "Preencha os campos obrigatórios.",
                            sType: "error",
                            sWidth: "",
                            iTime: null
                        });
                    }
                }
            },
            {
                text: "Cancelar",
                click: function () {
                    $(this).dialog('close');
                }
            }
        ],
        fnClose: function () {
            LimparModal('modal_fonte');
        }
    });
}

function onblurTipoDeFonte(){
    if($('#ch_tipo_norma').val() == '11000000' && $('#ch_tipo_fonte_modal').val() == '18'){
        $('#buttonProsseguirSemDiario').show();
    }
    else{
        $('#buttonProsseguirSemDiario').hide();
    }
}

function prosseguirSemDiario(){
    if(!IsNotNullOrEmpty($('#ch_tipo_fonte_modal').val()) || !IsNotNullOrEmpty($('#dt_assinatura_fonte_modal').val())){
        Validar('form_consultar_diario');
        return false;
    }
    $('#json_diario_fonte').val('{"ch_tipo_fonte": "' + $('#ch_tipo_fonte_modal').val() + '", "nm_tipo_fonte": "' + $('#nm_tipo_fonte_modal').val() + '", "dt_assinatura": "' + $('#dt_assinatura_fonte_modal').val() + '"}');
    $('#json_arquivo_diario_fonte').val('');
    $('#ds_diario').val($('#nm_tipo_fonte_modal').val() + ' de ' + $('#dt_assinatura_fonte_modal').val());
    $('#modal_fonte .consultar').hide();
    $('#modal_fonte .resultado').hide();
    $('#modal_fonte .diario').show();
}

function CriarModalOrigem() {
    $('#modal_origem .dados_orgao').hide();
    $("#modal_origem").modallight({
        sTitle: "Adicionar Origem",
        sWidth: '800',
        oButtons: [
            {
                text: "Salvar",
                click: function () {
                    var oOrgao = {};
                    oOrgao.ch_orgao = $('#ch_orgao').val();
                    oOrgao.sg_orgao = $('#label_sg_hierarquia_modal').text();
                    oOrgao.nm_orgao = $('#label_nm_hierarquia_modal').text();
                    var nm_orgao = $('#label_nm_orgao_modal').text();
                    var sg_orgao = $('#label_sg_orgao_modal').text();
                    if (IsNotNullOrEmpty(oOrgao.ch_orgao) && IsNotNullOrEmpty(oOrgao.nm_orgao) && IsNotNullOrEmpty(oOrgao.sg_orgao)) {
                        $('#tbody_origens .tr_vazia').remove();
                        var id_input = 'input_' + Guid('N');
                        $('#tbody_origens').append(
                            '<tr>' +
                                '<td>' + nm_orgao + '<input id="' + id_input + '" type="hidden" name="orgao" value="" /></td>' +
                                '<td>' + sg_orgao + '</td>' +
                                '<td>' + $('#label_sg_hierarquia_modal').text() + '</td>' +
                                '<td>' + $('#label_in_ambito_modal').text() + '</td>' +
                                '<td>' + $('#label_dt_inicio_vigencia_modal').text() + '</td>' +
                                '<td>' + $('#label_dt_fim_vigencia_modal').text() + '</td>' +
                                '<td>' + $('#label_orgao_cadastrador_modal').text() + '</td>' +
                                '<td class="control">' +
                                    '<a title="Excluir" href="javascript:void(0);" onclick="javascript:DeletarLinha(event); fnAutocompleteOrigem();"><img valign="absmiddle" alt="Excluir" src="' + _urlPadrao + '/Imagens/ico_delete_p.png"  /></a>' +
                                '</td>' +
                            '</tr>'
                        );
                        $('#' + id_input).val(JSON.stringify(oOrgao));
                        fnAutocompleteOrigem();
                        $(this).dialog('close');
                    }
                }
            },
            {
                text: "Cancelar",
                click: function () {
                    $(this).dialog('close');
                }
            }
        ],
        fnClose: function () {
            LimparModal('modal_origem');
        }
    });
}

function fnAppendAutoria(oAutoria) {
    $('#tbody_autorias .tr_vazia').remove();
//    var oAutoria = {ch_autoria: ch_autoria, nm_autoria: nm_autoria};
    var id_input = 'input_' + Guid('N');
    $('#tbody_autorias').append(
        '<tr>' +
            '<td><input id="' + id_input + '" type="hidden" name="autoria" value="" />' + oAutoria.nm_autoria + '</td>' +
            '<td class="control">' +
                '<a title="Excluir" href="javascript:void(0);" onclick="javascript:DeletarLinha(event);"><img valign="absmiddle" alt="Excluir" src="' + _urlPadrao + '/Imagens/ico_delete_p.png"  /></a>' +
            '</td>' +
        '</tr>'
    );
    $('#' + id_input).val(JSON.stringify(oAutoria));
}

function CriarModalAutoria() {
    $("#modal_autoria").modallight({
        sTitle: "Adicionar Autoria",
        sWidth: '500',
        oButtons: [
            {
                text: "Salvar",
                click: function () {
                    var ch_autoria = $('#ch_autoria').val();
                    var nm_autoria = $('#nm_autoria').val();
                    if (IsNotNullOrEmpty(ch_autoria)) {
                        fnAppendAutoria({ ch_autoria: ch_autoria, nm_autoria: nm_autoria });
                        $(this).dialog('close');
                    }
                }
            },
            {
                text: "Cancelar",
                click: function () {
                    $(this).dialog('close');
                }
            }
        ],
        fnClose: function () {
            LimparModal('modal_autoria');
        }
    });
}



function CriarModalInteressado() {
    $("#modal_interessado").modallight({
        sTitle: "Adicionar Interessado",
        sWidth: '500',
        oButtons: [
            {
                text: "Salvar",
                click: function () {
                    var ch_interessado = $('#ch_interessado').val();
                    var nm_interessado = $('#nm_interessado').val();
                    if (IsNotNullOrEmpty(ch_interessado) && IsNotNullOrEmpty(nm_interessado)) {
                        AdicionarInteressado(nm_interessado, ch_interessado);
                        $(this).dialog('close');
                    }
                }
            },
            {
                text: "Cancelar",
                click: function () {
                    $(this).dialog('close');
                }
            }
        ],
        fnClose: function () {
            LimparModal('modal_interessado');
        }
    });
}

function CriarModalNome() {
    $("#modal_nome").modallight({
        sTitle: "Adicionar Nome",
        sWidth: '500',
        oButtons: [
            {
                text: "Salvar",
                click: function () {
                    var nm_nome = $('#nm_nome').val();
                    if (IsNotNullOrEmpty(nm_nome)) {
                        $('#tbody_nomes .tr_vazia').remove();
                        $('#tbody_nomes').append(
                            '<tr>' +
                                '<td>' + nm_nome + '<input type="hidden" name="nm_nome" value="' + nm_nome + '" /></td>' +
                                '<td class="control">' +
                                    '<a title="Excluir" href="javascript:void(0);" onclick="javascript:DeletarLinha(event);"><img valign="absmiddle" alt="Excluir" src="'+_urlPadrao+'/Imagens/ico_delete_p.png"  /></a>' +
                                '</td>' +
                            '</tr>'
                        );
                        $(this).dialog('close');
                    }
                }
            },
            {
                text: "Cancelar",
                click: function () {
                    $(this).dialog('close');
                }
            }
        ],
        fnClose: function () {
            LimparModal('modal_nome');
        }
    });
}

function EditarIndexacao(event) {
    if (event != null) {
        var tr = $(event.target).closest('tr');
        var indexacao = $('input[name="indexacao"]', tr).val();
        if (IsNotNullOrEmpty(indexacao)) {
            $('#tbody_termos_modal .tr_vazia').remove();
            var indexacao_split = indexacao.split('|');
            for (var i = 0; i < indexacao_split.length; i++) {
                var termo_split = indexacao_split[i].split('#');
                $('#tbody_termos_modal').append(
                    '<tr>' +
                        '<td>' + termo_split[2] + '<input type="hidden" class="ch_termo_modal" value="' + termo_split[0] + '"/> <input type="hidden" class="ch_tipo_termo_modal" value="' + termo_split[1] + '" /><input type="hidden" class="nm_termo_modal" value="' + termo_split[2] + '" />' +
                        '<td class="control">' +
                            '<a title="Excluir" href="javascript:void(0);" onclick="javascript:DeletarLinha(event);"><img valign="absmiddle" alt="Excluir" src="' + _urlPadrao + '/Imagens/ico_delete_p.png"  /></a>' +
                        '</td>' +
                    '</tr>'
                );
            }
        }
        CriarModalIndexacao(tr);
    }
}

function CriarModalIndexacao(tr) {
    $("#modal_indexacao").modallight({
        sTitle: "Adicionar Indexação",
        sWidth: '700',
        oButtons: [
            {
                text: "Salvar",
                click: function () {
                    var inputs_hidden_ch_termo = $('#tbody_termos_modal .ch_termo_modal');
                    var inputs_hidden_ch_tipo_termo = $('#tbody_termos_modal .ch_tipo_termo_modal');
                    var inputs_hidden_nm_termo = $('#tbody_termos_modal .nm_termo_modal');
                    if ($(inputs_hidden_ch_tipo_termo[0]).val() == "ES") {
                        $('#modal_indexacao .notify').messagelight({
                            sContent: "Não é permitido iniciar indexação com especificador.",
                            sType: "error",
                            iTime: 5000
                        });
                        return false;
                    }
                    if (IsNotNullOrEmpty(inputs_hidden_ch_termo)) {
                        var ch_termos = "";
                        var ch_tipo_termos = "";
                        var nm_termos = "";
                        var indexacao = "";
                        var trs_indexacao = $('input[name="indexacao"]');
                        for (var i = 0; i < inputs_hidden_ch_termo.length; i++) {
                            ch_termos += (ch_termos != "" ? "#" : "") + $(inputs_hidden_ch_termo[i]).val();
                            ch_tipo_termos += (ch_tipo_termos != "" ? "#" : "") + $(inputs_hidden_ch_tipo_termo[i]).val();
                            nm_termos += (nm_termos != "" ? ", " : "") + $(inputs_hidden_nm_termo[i]).val();
                            indexacao += (indexacao != "" ? "|" : "") + $(inputs_hidden_ch_termo[i]).val() + "#"
                                    + $(inputs_hidden_ch_tipo_termo[i]).val() + "#"
                                    + $(inputs_hidden_nm_termo[i]).val();
                        }
                        if ($('input[name="indexacao"][value="' + indexacao + '"]').length > 0) {
                            $('#modal_indexacao .notify').messagelight({
                                sContent: "A indexacao já está sendo usada. Não é permitido repetir.",
                                sType: "error",
                                iTime: 5000
                            });
                            return false;
                        }
                        $('#tbody_indexacoes .tr_vazia').remove(
