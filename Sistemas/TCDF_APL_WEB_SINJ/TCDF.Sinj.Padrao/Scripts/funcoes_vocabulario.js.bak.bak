var _ch_termo = "";

function PreencherVocabularioEdicao() {
    var id_doc = GetParameterValue("id_doc");
    if (id_doc != "") {
        var sucesso = function (data) {
            if (IsNotNullOrEmpty(data)) {
                if (data.error_message != null && data.error_message != "") {
                    $('#div_notificacao_vocabulario').messagelight({
                        sTitle: "Erro",
                        sContent: data.error_message,
                        sType: "error",
                        sWidth: "",
                        iTime: null
                    });
                }
                if (data.ch_termo != null && data.ch_termo != "") {
                    $('#id_doc').val(data._metadata.id_doc);
                    $('#ch_tipo_termo option[value="' + data.ch_tipo_termo + '"]').attr('selected', 'selected');
                    SelecionarTipoDeTermo(true);
                    $('#nm_termo').val(data.nm_termo);
                    if (data.eh_descritor) {
                        if (IsNotNullOrEmpty(data, 'termos_gerais')) {
                            for (var i = 0; i < data.termos_gerais.length; i++) {
                                AdicionarTermo(data.termos_gerais[i].ch_termo_geral, data.termos_gerais[i].nm_termo_geral, "TG");
                            }
                        }
                        if (IsNotNullOrEmpty(data, 'termos_especificos')) {
                            for (var i = 0; i < data.termos_especificos.length; i++) {
                                AdicionarTermo(data.termos_especificos[i].ch_termo_especifico, data.termos_especificos[i].nm_termo_especifico, "TE");
                            }
                        }
                        if (IsNotNullOrEmpty(data, 'termos_relacionados')) {
                            for (var i = 0; i < data.termos_relacionados.length; i++) {
                                AdicionarTermo(data.termos_relacionados[i].ch_termo_relacionado, data.termos_relacionados[i].nm_termo_relacionado, "TR");
                            }
                        }
                    }
                    if (data.eh_lista_auxiliar) {
                        if (IsNotNullOrEmpty(data, 'ch_lista_superior')) {
                            $('#nm_lista_superior').val(data.nm_lista_superior);
                        }
                    }
                    if (IsNotNullOrEmpty(data, 'termos_nao_autorizados')) {
                        for (var i = 0; i < data.termos_nao_autorizados.length; i++) {
                            AdicionarTermo(data.termos_nao_autorizados[i].ch_termo_nao_autorizado, data.termos_nao_autorizados[i].nm_termo_nao_autorizado, "TNA");
                        }
                        $('.div_termos_nao_use').show();
                    }
                    $('#ds_nota_explicativa').text(GetText(data.ds_nota_explicativa));
                    $('#ds_fontes_pesquisadas').text(GetText(data.ds_fontes_pesquisadas));
                    $('#ds_texto_fonte').text(GetText(data.ds_texto_fonte));
                }
            }
        };
        var inicio = function () {
            $('#div_loading_vocabulario').show();
            $('#div_vocabulario').hide();
        }
        var complete = function () {
            $('#div_loading_vocabulario').hide();
            $('#div_vocabulario').show();
        }
        var teste = $.ajaxlight({
            sUrl: MostrarPaginaAjax('VIS') + window.location.search,
            sType: "POST",
            fnSuccess: sucesso,
            fnComplete: complete,
            fnBeforeSend: inicio,
            fnError: null,
            bAsync: true
        });
    }

}

function ConstruirControlesDinamicos() {
    $('#button_salvar_vocabulario').click(function () {
        return fnSalvar("form_vocabulario");
    });
    $('#button_criar_lista').click(function () {
        return fnSalvar("form_criar_lista");
    });
    var alfabeto = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'];
    for (var i = 0; i < alfabeto.length; i++) {
        var letra = alfabeto[i];
        $('#ul-alfabeto').append('<li class="li-alfabeto"><a href="javascript:void(0);" onclick="javascript:PesquisarAlfabeto(this);">' + alfabeto[i] + '</a></li>');
    }
    $('#div_autocomplete_lista_superior').autocompletelight({
        sKeyDataName: "ch_termo",
        sValueDataName: "nm_termo",
        sInputHiddenName: "ch_lista_superior",
        sInputName: "nm_lista_superior",
        sAjaxUrl: "./ashx/Autocomplete/VocabularioAutocomplete.ashx?id_doc_ignore=" + GetParameterValue("id_doc") + "&in_lista=true",
        bLinkAll: true,
        sLinkName: "a_lista_superior"
    });
    $('#div_pesquisa').autocompletelight({
        sKeyDataName: "ch_termo",
        sValueDataName: "nm_termo",
        sInputHiddenName: "input_ch_termo",
        bAddInexistente: true,
        sInputName: "input_nm_termo",
        sAjaxUrl: "./ashx/Autocomplete/VocabularioAutocomplete.ashx",
        bLinkAll: false
    });
    $('#div_resultado').hide();
}

function PesquisarAlfabeto(element) {
    $('#input_letra').val($(element).text());
    $('#form_vocabulario').submit();
}

function PesquisarVocabularioClick() {
    $('#form_vocabulario').submit();
}

function PesquisarVocabulario(filtro) {
    var search = window.location.search;
    $("#div_resultado").show();
    $("#div_resultado").dataTablesLight({
        sAjaxUrl: './ashx/Datatable/VocabularioDatatable.ashx' + (IsNotNullOrEmpty(search) ? search + (IsNotNullOrEmpty(filtro) ? '&' + filtro : '') : (IsNotNullOrEmpty(filtro) ? '?' + filtro : '')),
        aoColumns: _columns_vocabulario,
        bFilter: true
    });
}


function SelecionarTipoDeTermo(b_edicao) {
    $('.AU').hide();
    $('.DE').hide();
    $('.LA').hide();
    $('.ES').hide();
    $('.no-hide').hide();
    var selected = $('#ch_tipo_termo').val();
    if(IsNotNullOrEmpty(selected)){
        $('.' + selected).show();
        $('.no-hide').show();
        if (!b_edicao) {
            if (selected == "AU") {
                $('#nm_termo').blur(function () {
                    $('#img_alerta_existente').remove();
                    if ($('#nm_termo').val() != "") {
                        var sucesso = function (data) {
                            if (IsNotNullOrEmpty(data)) {
                                if (data.results != null && data.results.length > 0) {
                                    var orgaos = "";
                                    for (var i = 0; i < data.results.length; i++) {
                                        orgaos += (i + 1) + ". " + data.results[i].sg_hierarquia + " - " + data.results[i].nm_orgao + "<br/>";
                                    }
                                    if (orgaos != "") {
                                        $("#div_notificacao_vocabulario").modallight({
                                            sTitle: "Nome Duplicado!",
                                            oPosition: { my: "center", at: "center", of: "#nm_termo" },
                                            sContent: "Um ou mais Órgãos já possuem esse nome:<br/>" + orgaos,
                                            sType: "alert",
                                            sWidth: "350"
                                        });
                                        $('#nm_termo').parent().append('<img id="img_alerta_existente" src="' + _urlPadrao + '/Imagens/ico_alert_p.png" alt="atenção" title="Existe um órgão com este nome"/>');
                                    }
                                }
                            }
                        };
                        $.ajaxlight({
                            sUrl: './ashx/Consulta/OrgaoConsulta.ashx?nm_orgao=' + $('#nm_termo').val().replace(/\(.+?\)/, ""),
                            sType: "GET",
                            fnSuccess: sucesso,
                            bAsync: true
                        });
                    }
                });
            }
        }
    }
}

function DetalhesVocabulario() {
    var id_doc = GetParameterValue("id_doc");
    var ch_termo = GetParameterValue("ch_termo");
    if (id_doc != "" || ch_termo != "") {
        var sucesso = function (data) {
            if (IsNotNullOrEmpty(data)) {
                if (data.error_message != null && data.error_message != "") {
                    $('#div_notificacao_vocabulario').messagelight({
                        sTitle: "Erro",
                        sContent: data.error_message,
                        sType: "error",
                        sWidth: "",
                        iTime: null
                    });
                }
                if (data.ch_termo != null && data.ch_termo != "") {
                    _ch_termo = data.ch_termo;
                    if (ValidarPermissao(_grupos.voc_edt)) {
                        $('#div_controls_detalhes').append(
                            '<a title="Editar Termo" href="./EditarVocabulario.aspx?id_doc=' + data._metadata.id_doc + '"><img alt="editar" src="'+_urlPadrao+'/Imagens/ico_pencil_p.png"/></a> &nbsp;'
                        );
                    }
                    if (ValidarPermissao(_grupos.voc_exc)) {
                        if (!data.st_excluir) {
                            $('#div_controls_detalhes').append(
                                '<a id="quarentena" title="Excluir Termo" href="javascript:void(0);" onclick="javascript:MoverTermoParaQuarentena(' + data._metadata.id_doc + ', false);" ><img alt="excluir" src="'+_urlPadrao+'/Imagens/ico_trash_p.png"/></a>'
                            );
                        }
                        else if (ValidarPermissao(_grupos.voc_ger)) {
                            $('#div_controls_detalhes').append(
                                '<a id="quarentena" title="Restaurar Termo" href="javascript:void(0);" onclick="javascript:MoverTermoParaQuarentena(' + data._metadata.id_doc + ', true);" ><img alt="restaurar" src="'+_urlPadrao+'/Imagens/ico_undo_p.png"/></a>'
                            );
                        }
                    }
                    $('#label_tipo_termo').text(data.nm_tipo_termo);
                    $('#label_nm_termo').text(data.nm_termo);
                    $('#img_status').css('visibility', data.st_aprovado ? 'hidden' : 'visible');
                    if (data.eh_descritor) {
                        if (IsNotNullOrEmpty(data, 'termos_gerais')) {
                            for (var i = 0; i < data.termos_gerais.length; i++) {
                                $('#ul_termos_gerais').append('<li><a href="./DetalhesDeVocabulario.aspx?ch_termo=' + data.termos_gerais[i].ch_termo_geral + '" title="Visualizar detalhes do termo">' + data.termos_gerais[i].nm_termo_geral + '<img alt="detalhes" src="'+_urlPadrao+'/Imagens/ico_loupe_p.png" /></a></li>');
                            }
                            $('.div_termos_gerais').show();
                        }
                        if (IsNotNullOrEmpty(data, 'termos_especificos')) {
                            for (var i = 0; i < data.termos_especificos.length; i++) {
                                $('#ul_termos_especificos').append('<li><a href="./DetalhesDeVocabulario.aspx?ch_termo=' + data.termos_especificos[i].ch_termo_especifico + '" title="Visualizar detalhes do termo">' + data.termos_especificos[i].nm_termo_especifico + '<img alt="detalhes" src="'+_urlPadrao+'/Imagens/ico_loupe_p.png" /></a></li>');
                            }
                            $('.div_termos_especificos').show();
                        }
                        if (IsNotNullOrEmpty(data, 'termos_relacionados')) {
                            for (var i = 0; i < data.termos_relacionados.length; i++) {
                                $('#ul_termos_relacionados').append('<li><a href="./DetalhesDeVocabulario.aspx?ch_termo=' + data.termos_relacionados[i].ch_termo_relacionado + '" title="Visualizar detalhes do termo">' + data.termos_relacionados[i].nm_termo_relacionado + '<img alt="detalhes" src="'+_urlPadrao+'/Imagens/ico_loupe_p.png" /></a></li>');
                            }
                            $('.div_termos_relacionados').show();
                        }
                    }
                    if (data.eh_lista_auxiliar) {
                        if (IsNotNullOrEmpty(data, 'sublistas')) {
                            for (var i = 0; i < data.sublistas.length; i++) {
                                $('#ul_termos_sublista').append('<li><a href="./DetalhesDeVocabulario.aspx?ch_termo=' + data.sublistas[i].ch_termo + '" title="Visualizar detalhes do termo">' + data.sublistas[i].nm_termo + '<img alt="detalhes" src="'+_urlPadrao+'/Imagens/ico_loupe_p.png" /></a></li>');
                            }
                            $('.div_termos_sublista').show();
                        }
                        if (IsNotNullOrEmpty(data, 'itens')) {
                            for (var i = 0; i < data.itens.length; i++) {
                                $('#ul_termos_itens').append('<li><a href="./DetalhesDeVocabulario.aspx?ch_termo=' + data.itens[i].ch_termo + '" title="Visualizar detalhes do termo">' + data.itens[i].nm_termo + '<img alt="detalhes" src="'+_urlPadrao+'/Imagens/ico_loupe_p.png" /></a></li>');
                            }
                            $('.div_termos_itens').show();
                        }
                        if (data.lista != null && data.lista.nm_termo) {
                            $('#ul_termos_lista').append('<li><a href="./DetalhesDeVocabulario.aspx?ch_termo=' + data.lista.ch_termo + '" title="Visualizar detalhes do termo">' + data.lista.nm_termo + '<img alt="detalhes" src="'+_urlPadrao+'/Imagens/ico_loupe_p.png" /></a></li>');
                            $('.div_termos_lista').show();
                        }
                    }
                    if (IsNotNullOrEmpty(data.nm_termo_use)) {
                        $('#ul_termos_use').append('<li><a href="./DetalhesDeVocabulario.aspx?ch_termo=' + data.ch_termo_use + '" title="Visualizar detalhes do termo">' + data.nm_termo_use + '<img alt="detalhes" src="'+_urlPadrao+'/Imagens/ico_loupe_p.png" /></a></li>');
                        $('.div_termos_use').show();
                    }
                    if (IsNotNullOrEmpty(data, 'termos_nao_autorizados')) {
                        for (var i = 0; i < data.termos_nao_autorizados.length; i++) {
                            $('#ul_termos_nao_use').append('<li><a href="./DetalhesDeVocabulario.aspx?ch_termo=' + data.termos_nao_autorizados[i].ch_termo_nao_autorizado + '" title="Visualizar detalhes do termo">' + data.termos_nao_autorizados[i].nm_termo_nao_autorizado + '<img alt="detalhes" src="'+_urlPadrao+'/Imagens/ico_loupe_p.png" /></a></li>');
                        }
                        $('.div_termos_nao_use').show();
                    }
                    $('#div_nota_explicativa').text(GetText(data.ds_nota_explicativa));
                    $('#div_fontes_pesquisadas').text(GetText(data.ds_fontes_pesquisadas));
                    $('#div_texto_fonte').text(GetText(data.ds_texto_fonte));
                    if (ValidarPermissao(_grupos.voc_ger)) {
                        if (data.st_ativo) {
                            $('#div_controls_detalhes').prepend('<a title="Inativar Termo" href="javascript:void(0);" onclick="javascript:InativarTermo(' + data._metadata.id_doc + ',false,event, true);"><img alt="inativar" src="'+_urlPadrao+'/Imagens/ico_unlock_p.png"/></a> &nbsp;');
                        }
                        else {
                            $('#div_controls_detalhes').prepend('<a title="Ativar Termo" href="javascript:void(0);" onclick="javascript:InativarTermo(' + data._metadata.id_doc + ',true,event, true);"><img alt="ativar" src="'+_urlPadrao+'/Imagens/ico_lock_p.png"/></a> &nbsp;');
                        }
                        if (data.st_aprovado) {
                            $('#div_controls_detalhes').prepend('<a title="Tornar Pendente" href="javascript:void(0);" onclick="javascript:AprovarTermo(' + data._metadata.id_doc + ',false,event, null, true);"><img alt="aprovado" src="'+_urlPadrao+'/Imagens/ico_ok_p.png"/></a> &nbsp;');
                        }
                        else {
                            $('#div_controls_detalhes').prepend('<a title="Aprovar Termo" href="javascript:void(0);" onclick="javascript:AprovarTermo(' + data._metadata.id_doc + ',true,event, null, true);"><img alt="pendente" src="'+_urlPadrao+'/Imagens/ico_alert_p.png"/></a> &nbsp;');
                        }
                        $('#div_controls_detalhes').append("<div class='loading-p' style='display:none;'></div>");
                    }
                }
            }
        };
        var inicio = function () {
            $('#div_loading_vocabulario').show();
            $('#div_vocabulario').hide();
        }
        var complete = function () {
            $('#div_loading_vocabulario').hide();
            $('#div_vocabulario').show();
        }
        $.ajaxlight({
            sUrl: MostrarPaginaAjax('VIS') + window.location.search,
            sType: "POST",
            fnSuccess: sucesso,
            fnComplete: complete,
            fnBeforeSend: inicio,
            fnError: null,
            bAsync: true
        });
    }
}

function ExpandirTabelaDeOrgaos() {
    if ($('#a_selecionar_origens img').hasClass('opened')) {
        $('#a_selecionar_origens img').removeClass('opened');
        $('#a_selecionar_origens img').addClass('closed');
        $('#a_selecionar_origens img').prop('src', _urlPadrao + '/Imagens/ico_arrow_down.png');
        $('#div_datatable_origens').hide();
    }
    else {
        $('#a_selecionar_origens img').removeClass('closed');
        $('#a_selecionar_origens img').addClass('opened');
        $('#div_datatable_origens').show();
        $('#a_selecionar_origens img').prop('src', _urlPadrao + '/Imagens/ico_arrow_up.png');
        $("#div_datatable_origens").dataTablesLight({
            sAjaxUrl: './ashx/Datatable/OrgaoDatatable.ashx?st_autoridade=false',
            aoColumns: _columns_autoridade,
            sIdTable: 'datatable_selecionar_origens',
            bFilter: true
        });
    }
}

function SelecionarOrgaoAutoridade(ch_orgao, nm_orgao, sg_orgao, dt_inicio_vigencia, dt_fim_vigencia) {
    if (ch_orgao != null && nm_orgao != null && ch_orgao != "" && nm_orgao != "") {
        var anoInicio = "";
        var anoFim = "";
        var vigencia = "";
        if (IsNotNullOrEmpty(dt_inicio_vigencia)) {
            var dt_inicio_split = dt_inicio_vigencia.split('/');
            if (dt_inicio_split.length == 3) {
                anoInicio = dt_inicio_split[2];
            }
        }
        if (IsNotNullOrEmpty(dt_fim_vigencia)) {
            var dt_fim_split = dt_fim_vigencia.split('/');
            if (dt_fim_split.length == 3) {
                anoFim = dt_fim_split[2];
            }
        }
        if (anoInicio != "" || anoFim != "") {
            vigencia = " " + anoInicio + "-" + anoFim;
        }
        $('#ch_orgao').val(ch_orgao);
        $('#nm_termo').val(nm_orgao + "(" + sg_orgao + vigencia + ")");
        $('#img_alerta_existente').remove();
        $('#nm_termo').prop("disabled", true);
        $('#a_removerOrgaoAutoridade').show();
    }
}

function RemoverOrgaoAutoridade() {
    $('#ch_orgao').val("");
    $('#nm_termo').val("");
    $('#nm_termo').prop("disabled", false);
    $('#a_removerOrgaoAutoridade').hide();
}

function ExpandirTabelaDeTermos() {
    if ($('#a_selecionar_termos img').hasClass('opened')) {
        $('#a_selecionar_termos img').removeClass('opened');
        $('#a_selecionar_termos img').addClass('closed');
        $('#a_selecionar_termos img').prop('src', _urlPadrao + '/Imagens/ico_arrow_down.png');
        $('#div_datatable_termos').hide();
    }
    else {
        $('#a_selecionar_termos img').removeClass('closed');
        $('#a_selecionar_termos img').addClass('opened');
        $('#div_datatable_termos').show();
        $('#a_selecionar_termos img').prop('src', _urlPadrao + '/Imagens/ico_arrow_up.png');
        $("#div_datatable_termos").dataTablesLight({
            sAjaxUrl: './ashx/Datatable/VocabularioDatatable.ashx?id_doc_ignored=' + GetParameterValue("id_doc") + '&ch_tipo_termo=' + $('#ch_tipo_termo').val(),
            aoColumns: _columns_vocabulario_selecionar,
            sIdTable: 'datatable_selecionar_termos',
            bFilter: true
        });
    }
}

function ExpandirTabelaDeNormas() {
    if ($('#a_selecionar_normas img').hasClass('opened')) {
        $('#a_selecionar_normas img').removeClass('opened');
        $('#a_selecionar_normas img').addClass('closed');
        $('#a_selecionar_normas img').prop('src', _urlPadrao + '/Imagens/ico_arrow_down.png');
        $('#div_datatable_normas').hide();
    }
    else {
        $('#a_selecionar_normas img').removeClass('closed');
        $('#a_selecionar_normas img').addClass('opened');
        $('#div_datatable_normas').show();
        $('#a_selecionar_normas img').prop('src', _urlPadrao + '/Imagens/ico_arrow_up.png');
        $("#div_datatable_normas").dataTablesLight({
            sAjaxUrl: './ashx/Datatable/NormaDatatable.ashx?ch_termo=' + _ch_termo,
            aoColumns: _columns_norma_associada_vocabulario,
            sIdTable: 'datatable_normas',
            bFilter: true
        });
    }
}

function VerificarSeTermoNaoEstaAdicionado(ch_termo) {
    var selectors = ['input[name="termos_nao_autorizados"]', 'input[name="termos_gerais"]', 'input[name="termos_especificos"]', 'input[name="termos_relacionados"]'];
    for (var s = 0; s < selectors.length; s++) {
        var inputsTermosSelecionados = $(selectors[s]);
        for (var i = 0; i < inputsTermosSelecionados.length; i++) {
            if (IsNotNullOrEmpty(inputsTermosSelecionados[i].value)) {
                var chave = inputsTermosSelecionados[i].value.split('#')[0];
                if(chave == ch_termo) return false;
            }
        }
    }
    return true;
}

function AdicionarTermo(ch_termo, nm_termo, ch_relacao) {
    if (IsNotNullOrEmpty(ch_termo) && IsNotNullOrEmpty(nm_termo) && IsNotNullOrEmpty(ch_relacao)) {
        var value = ch_termo + "#" + nm_termo;
        var sufixo = ch_relacao == "TNA" ? "termos_nao_autorizados" : ch_relacao == "TR" ? "termos_relacionados" : ch_relacao == "TE" ? "termos_especificos" : ch_relacao == "TG" ? "termos_gerais" : "";
        if ($('input[name="'+sufixo+'"][value="' + value + '"]').length > 0) {
            return false;
        }
        $('div#' + sufixo).append('<div><input type="hidden" name="' + sufixo + '" value="' + value + '" />' + nm_termo + '&nbsp;<a href="javascript:void();" onclick="javascript:RemoverDaLista(this,\'' + ch_termo + '\');"><img src="'+_urlPadrao+'/Imagens/ico_delete_p.png" /></a></div>');
        $('div#' + sufixo).show();
        $('a[ch_termo="' + ch_termo + '"]').hide();
    }
}

function RemoverDaLista(a, value) {
    var div = a.parentNode.parentNode;
    $(a.parentNode).remove();
    var testar = $(div).text().replace(/\s/gi, '');
    if(IsNotNullOrEmpty(value)){
        $('a[ch_termo="' + value + '"]').show();
    }
}

function fnQuarentena(_id_doc, _bRestaurar) {
    var sucesso = function (data) {
        if (IsNotNullOrEmpty(data, 'id_doc_success')) {
            $('#div_notificacao_vocabulario').messagelight({
                sTitle: "Sucesso",
                sContent: (_bRestaurar ? "Restaurado com sucesso." : "Movido para quarentena com sucesso."),
                sType: "success",
                sWidth: ""
            });
            $('img', $('#quarentena')).prop('src', './Imagens/' + (!_bRestaurar ? "ico_undo_p" : "ico_trash_p") + '.png');
            $('img', $('#quarentena')).prop('alt', (!_bRestaurar ? "restaurar" : "excluir"));
            $('#quarentena').attr('onclick', 'javascript:MoverTermoParaQuarentena(' + _id_doc + ',' + !_bRestaurar + ')');
            $('#quarentena').attr('title', (!_bRestaurar ? "Restaurar Termo" : "Mover Termo para Quarentena"));
            $('#modal_termo_quarentena').dialog("close");
        }
        else if (IsNotNullOrempty(data, 'error_message')) {
            $('.notify', $('#modal_termo_quarentena')).messagelight({
                sTitle: "Erro",
                sContent: data.error_message,
                sType: "error",
                sWidth: ""
            });
        }
        else {
            $('.notify', $('#modal_termo_quarentena')).messagelight({
                sTitle: "Erro",
                sContent: "Ocorreu um erro não identificado.",
                sType: "error",
                sWidth: ""
            });
        }
    }
    var inicio = function () {
        $('.loaded', $('#modal_termo_quarentena')).hide();
        $('.loading', $('#modal_termo_quarentena')).show();
    }
    var complete = function () {
        $('.loaded', $('#modal_termo_quarentena')).show();
        $('.loading', $('#modal_termo_quarentena')).hide();
    }
    $.ajaxlight({
        sUrl: './ashx/Path/VocabularioPath.ashx?id_doc=' + _id_doc + '&path=st_excluir&value=' + !_bRestaurar,
        sType: "GET",
        fnSuccess: sucesso,
        fnComplete: complete,
        fnBeforeSend: inicio,
        bAsync: true
    });
}

function fnCancelarQuarentena() {
    $('#modal_termo_quarentena').dialog('close');
}

function MoverTermoParaQuarentena(id_doc, bRestaurar) {
    var html = '<div class="mauto table">' +
                    '<div class="line">' +
                        '<div class="column w-100-pc">' +
                            '<div class="cell w-100-pc">' +
                                (bRestaurar ? 'Deseja Restaurar o Termo?' : 'O Termo será movido para quarentena. Deseja continuar?') +
                            '</div>' +
                        '</div>' +
                    '</div>' +
                '</div>' +
                '<div class="notify" style="display:none;">' +
                '</div>' +
                '<div class="loading" style="display:none;"></div>' +
                '<div style="width:220px; margin:auto;" class="loaded">' +
                    '<button onclick="javascript:fnQuarentena(' + id_doc + ',' + bRestaurar + ');">' +
                        '<img src="'+_urlPadrao+'/Imagens/ico_ok_p.png" />Sim' +
                    '</button>' +
                    '<button onclick="javascript:fnCancelarQuarentena();">' +
                        '<img src="'+_urlPadrao+'/Imagens/ico_delete_p.png" />Nao' +
                    '</button>' +
                '</div>';
    if ($('#modal_termo_quarentena').length > 0) {
        $('#modal_termo_quarentena').html(html);
        $('#modal_termo_quarentena').dialog('open');
    }
    else {
        $('<div id="modal_termo_quarentena" />').modallight({
            sTitle: "Quarentena",
            sType: "default",
            sContent: html,
            sWidth: 500,
            oButtons: []
        });
    }
}

//Funcoes Gerenciar Vocabulario

function PesquisarTermosTrocarTermo(filtro) {
    $("#div_datatable_torcar_termos").dataTablesLight({
        sAjaxUrl: './ashx/Datatable/VocabularioDatatable.ashx' + (IsNotNullOrEmpty(filtro) ? '?' + filtro : ''),
        aoColumns: _columns_vocabulario_trocar,
        bFilter: true,
        sIdTable: 'datatable_trocar'
    });
}

function ClicarAbaTrocarTermo() {
    PesquisarTermosTrocarTermo();
    $('#id_doc_termo_antigo_autocomplete').val('');
    $('#ch_tipo_termo_antigo_autocomplete').val('');
    $('#nm_termo_antigo_autocomplete').val('');
    $('#id_doc_termo_novo_autocomplete').val('');
    $('#nm_termo_novo_autocomplete').val('');
    $('#nm_termo_antigo_autocomplete').prop('disabled', true);
    $('.termo-antigo').hide();
    $('.termo-novo').hide();
    $('.cancelar').hide();
    $('#div_trocar_termo').hide();
    $('#div_datatable_torcar_termos').show();
}

function ClicarAbaQuarentena(filtro) {
    $("#div_datatable_termos_quarentena").dataTablesLight({
        sAjaxUrl: './ashx/Datatable/VocabularioDatatable.ashx?st_excluir=true' + (IsNotNullOrEmpty(filtro) ? '&' + filtro : ''),
        aoColumns: _columns_vocabulario_quarentena,
        bFilter: true,
        sIdTable: 'datatable_quarentena'
    });
}

function ClicarAbaPendentes(filtro) {
    $("#div_datatable_termos_pendentes").dataTablesLight({
        sAjaxUrl: './ashx/Datatable/VocabularioDatatable.ashx?st_aprovado=false' + (IsNotNullOrEmpty(filtro) ? '&' + filtro : ''),
        aoColumns: _columns_vocabulario_pendentes,
        bFilter: true,
        sIdTable: 'datatable_pendentes'
    });
}

function ClicarAbaInativos(filtro) {
    $("#div_datatable_termos_inativos").dataTablesLight({
        sAjaxUrl: './ashx/Datatable/VocabularioDatatable.ashx?st_ativo=false' + (IsNotNullOrEmpty(filtro) ? '&' + filtro : ''),
        aoColumns: _columns_vocabulario_inativos,
        bFilter: true,
        sIdTable: 'datatable_inativos'
    });
}

function ClicarAbaRestaurados(filtro) {
    $("#div_datatable_termos_restaurados").dataTablesLight({
        sAjaxUrl: './ashx/Datatable/VocabularioDatatable.ashx?st_restaurado=true' + (IsNotNullOrEmpty(filtro) ? '?' + filtro : ''),
        aoColumns: _columns_vocabulario_restaurados,
        bFilter: true,
        sIdTable: 'datatable_restaurados'
    });
}

function fnExcluirTermo(id_datatable) {
    $('#div_notificacao_modal_exclusao').html('');
    try {
        Validar("form_exclusao");
        var sucesso = function (data) {
            if (IsNotNullOrEmpty(data)) {
                $('#div_loading_modal_exclusao').hide();
                $('#div_buttons_modal_exclusao').show();
                if (data.error_message != null && data.error_message != "") {
                    $('#div_notificacao_modal_exclusao').messagelight({
                        sTitle: "Erro",
                        sContent: data.error_message,
                        sType: "error",
                        sWidth: "",
                        iTime: null
                    });
                }
                else if (data.excluido != null && data.excluido == true) {
                    $('#' + id_datatable + ' tr.selected').remove();
                    $('#div_notificacao_termos_quarentena').messagelight({
                        sTitle: "Sucesso",
                        sContent: "Excluído com sucesso.",
                        sType: "success",
                        sWidth: "",
                        iTime: 5000
                    });
                    $('#modal_exclusao').dialog("close");
                }
                else {
                    $('#div_notificacao_modal_exclusao').messagelight({
                        sTitle: "Erro",
                        sContent: "Erro na exclusão.",
                        sType: "error",
                        sWidth: "",
                        iTime: null
                    });
                }
            }
        }
        var beforeSubmit = function () {
            $('#div_loading_modal_exclusao').show();
            $('#div_buttons_modal_exclusao').hide();
        };
        $.ajaxlight({
            sUrl: './ashx/Exclusao/VocabularioExcluir.ashx',
            sType: "POST",
            fnSuccess: sucesso,
            sFormId: "form_exclusao",
            fnBeforeSubmit: beforeSubmit
        });
    }
    catch (ex) {
        $("#div_notificacao_modal_exclusao").messagelight({
            sTitle: "Erro nos dados informados",
            sContent: ex,
            sType: "error"
        });
    }
    return false;
}

function ExcluirTermo(id_doc, id_datatable) {
    var html = '<form id="form_exclusao" name="formExclusao" action="#" method="POST">' +
        '<input id="id_doc" type="hidden" value="' + id_doc + '" label="ID" obrigatorio="sim" name="id_doc" />' +
        '<input type="hidden" value="true" name="force" />' +
        '<div class="mauto table">' +
            '<div class="line">' +
                '<div class="column w-20-pc">' +
                    '<div class="cell fr">' +
                        '<label>Justificativa:</label>' +
                    '</div>' +
                '</div>' +
                '<div class="column w-70-pc">' +
                    '<div class="cell w-100-pc">' +
                        '<textarea label="Justificativa" obrigatorio="sim" id="justificativa" name="justificativa" class="w-90-pc" cols="100" rows="5" style="max-width:100%;" ></textarea>' +
                    '</div>' +
                '</div>' +
            '</div>' +
        '</div>' +
        '<div id="div_notificacao_mod
